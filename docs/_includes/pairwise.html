<h1>{{ include.title }}{{ include.button }}</h1>
{{ include.content | markdownify }}

<a href="#" onclick="storeAndNext('left')">
  <div class="block">
    <div id="left_img_{{page.round}}" class="img right"></div>
    <label id="left_title_{{page.round}}">Empty</label>
  </div>
</a>
<a href="#" onclick="storeAndNext('right')">
  <div class="block">
    <div id="right_img_{{page.round}}" class="img left"></div>
    <label id="right_title_{{page.round}}">Empty</label>
  </div>
</a>
<button class="submit restart" type="button" onclick="storeAndNext('skip')">Skip</button>


<div id="bottombar">
  <div>
    <button class="submit restart" type="button" onclick="previousPage()">Restart</button>
  </div>
  <div id="slider_{{page.round}}"></div>
</div>

<input type="hidden" id="answers_{{page.round}}" name="answers_{{page.round}}" value="">

<script>
  var prompts = {{ site.data.prompts | jsonify }}    
  var combos = [];
  var count = 0;
  var round =  {{ page.round }};
  var answers_1 = [];
  var answers_2 = [];
  const shuffle = ([...arr]) => {
    let m = arr.length;
    while (m) {
      const i = Math.floor(Math.random() * m--);
      [arr[m], arr[i]] = [arr[i], arr[m]];
    }
    return arr;
  };

  function calcCombos() {
    selected_prompts = shuffle(prompts).slice(1, 5 + 1);
    for (var i = 0; i < selected_prompts.length; i++)
      for (var j = i + 1; j < selected_prompts.length; j++)
      {
        combos[combos.length] = [i, j, false]
      }
    // randomize combos
    combos = combos.sort(function() { return 0.5 - Math.random() })
  }

  function storeAndNext(answer) {
    var left = document.getElementById("left_title_" + round).innerHTML
    var right = document.getElementById("right_title_" + round).innerHTML

    setVal(left, right, answer)
    next()
  }

  function setContent(id, prompt) {
    //document.getElementById(id + "_title").innerHTML = name
    document.getElementById(id + "_img_" + round).innerHTML = prompt;
    //document.getElementById(id + "_img").style.backgroundImage = "url('" + img + "')";
    //document.getElementById(id + "_img").style.backgroundPosition = pos;
  }

  function setVal(a, b, slider, round) {
    if (round == 1) {
      answers_1	[answers_1.length] = [a, b, slider]
    } else {
      answers_2	[answers_2.length] = [a, b, slider]
    }
  }

  function next() {
    document.getElementById("slider_" + round).style.width = (count / combos.length) * 100 + "%";
    if (count < combos.length) {
      var curPair = combos[count]
      setContent("left", prompts[curPair[0]].prompt)

      setContent("right", prompts[curPair[1]].prompt)
      count++
    } else {
      if (round == 1) {
        document.getElementById("answers_1").value = JSON.stringify(answers_1);
      } else {
        document.getElementById("answers_2").value = JSON.stringify(answers_2);
      }
      nextPage()
    }
  }

  function previous() {
    document.getElementById("slider_" + round).style.width = (count / combos.length) * 100 + "%";
    if (count < combos.length) {
      count--
      var curPair = combos[count]
      setContent("left", animals[curPair[0]].title, animals[curPair[0]].image, animals[curPair[0]].prompt)
    } else {
      previousPage()
    }
  }

</script>

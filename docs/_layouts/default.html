<!DOCTYPE html>
<html lang="en-us">

{% include head.html %}
<body onload="start()">
    <form id="promptForm" class="ajaxForm form autofill" method="POST" action="https://formcarry.com/s/hOMJJsIDFTb">
        <input type="hidden" name="_next" value="{{ site.url }}{{ pageform.redirect }}" />
      
          {% for page in site.pages %}
          <section id="page{{page.pageNo}}" class="page">
            <!-- page.layout: {{ page.layout }} -->
            {% if page.layout == "text" %}
            {% include text.html content=page.content title=page.title button=page.button %}
            {% endif %}


            {% if page.layout == "form" %}
            {% include form.html content=page.content form="0" button=page.button %}
            {% endif %}


            {% if page.layout == "pairwise" %}
            {% include pairwise.html content=page.content title=page.title questions=page.questions %}
            {% endif %}

          </section>
          {% endfor %}

    
    
    </form>


    <script src="/docs/js/app.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
    <script>
      var animals = {{ include.questions | jsonify }}
        var combos = [];
        var count = 0;
        var answers = []

        function calcCombos() {
          for (var i = 0; i < animals.length; i++)
            for (var j = i + 1; j < animals.length; j++)
            {
              combos[combos.length] = [i, j, false]
            }
          // randomize combos
          combos = combos.sort(function() { return 0.5 - Math.random() })
        }

        function storeAndNext(answer) {
          var left = document.getElementById("left_title").innerHTML
          var right = document.getElementById("right_title").innerHTML

          setVal(left, right, answer)
          next()
        }

        function setContent(id, name, img, pos, prompt) {
          document.getElementById(id + "_title").innerHTML = name
          document.getElementById(id + "_img").innerHTML = prompt;
          document.getElementById(id + "_img").style.backgroundImage = "url('" + img + "')";
          document.getElementById(id + "_img").style.backgroundPosition = pos;
        }

        function setVal(a, b, slider) {
          answers[answers.length] = [a, b, slider]
        }

        function next() {
          document.getElementById("slider").style.width = (count / combos.length) * 100 + "%";
          if (count < combos.length) {
            var curPair = combos[count]
            setContent("left", animals[curPair[0]].title, animals[curPair[0]].image, animals[curPair[0]].img_pos, animals[curPair[0]].prompt)

            setContent("right", animals[curPair[1]].title, animals[curPair[1]].image, animals[curPair[1]].img_pos, animals[curPair[1]].prompt)
            count++
          } else {
            nextPage()
          }
        }

        function previous() {
          document.getElementById("slider").style.width = (count / combos.length) * 100 + "%";
          if (count < combos.length) {
            count--
            var curPair = combos[count]
            setContent("left", animals[curPair[0]].title, animals[curPair[0]].image, animals[curPair[0]].img_pos)
          } else {
            previousPage()
          }
        }


      $(function(){
          $("#submitform").submit(function(e){
              e.preventDefault();
              var href = $(this).attr("action");
              var data = $(this).serialize();
              data["answers"] = answers;
              $.ajax({
                  type: "POST",
                  dataType: "json",
                  url: href,
                  data: data,
                  success: function(response){
                      if(response.status == "success"){
                          alert("We received your submission, thank you!");
                      }else{
                          alert("An error occured: " + response.message);
                      }
                  }
              });
          });
      });
    </script>
</body>

</html>
